# LangChain4j Order Agent

åŸºäº LangChain4j å’Œ Spring Boot çš„æ™ºèƒ½è®¢å•ç®¡ç†ç³»ç»Ÿï¼Œæ”¯æŒå¤šAgentåä½œå’Œä¼šè¯è®°å¿†ç®¡ç†ã€‚

## åŠŸèƒ½ç‰¹æ€§

- ğŸ¤– **å¤šAgentæ¶æ„**: åŒ…å«åˆ›å»ºã€æŸ¥è¯¢ã€æ›´æ–°ã€å–æ¶ˆè®¢å•çš„ä¸“é—¨Agent
- ğŸ§  **æ™ºèƒ½è·¯ç”±**: TriageAgentè‡ªåŠ¨è¯†åˆ«ç”¨æˆ·æ„å›¾å¹¶åˆ†å‘åˆ°å¯¹åº”Agent
- ğŸ’¾ **ä¼šè¯è®°å¿†**: æ”¯æŒä¼šè¯çº§åˆ«å’ŒAgentçº§åˆ«çš„å¯¹è¯è®°å¿†ç®¡ç†
- ğŸ”„ **è·¨Agentä¸Šä¸‹æ–‡**: æ”¯æŒAgenté—´çš„ä¸Šä¸‹æ–‡ä¼ é€’
- ğŸŒ **REST API**: æä¾›å®Œæ•´çš„HTTPæ¥å£
- ğŸ¨ **Webç•Œé¢**: å†…ç½®æµ‹è¯•é¡µé¢ï¼Œæ–¹ä¾¿äº¤äº’æµ‹è¯•

## å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒè¦æ±‚

- Java 17+
- Maven 3.6+
- OpenAI API Key (å¯é€‰ï¼Œç”¨äºå®é™…AIåŠŸèƒ½)

### 2. é…ç½®

#### è®¾ç½®OpenAI API Key (æ¨è)

```bash
# Windows
set OPENAI_API_KEY=your-api-key-here

# Linux/Mac
export OPENAI_API_KEY=your-api-key-here
```

#### æˆ–ä¿®æ”¹é…ç½®æ–‡ä»¶

ç¼–è¾‘ `src/main/resources/application.yml`:

```yaml
openai:
  api:
    key: your-api-key-here
    base-url: https://api.openai.com/v1  # æˆ–å…¶ä»–å…¼å®¹çš„APIåœ°å€
  model:
    name: gpt-3.5-turbo  # æˆ–å…¶ä»–æ¨¡å‹
```

### 3. è¿è¡Œé¡¹ç›®

```bash
# ç¼–è¯‘é¡¹ç›®
mvn clean compile

# è¿è¡Œé¡¹ç›®
mvn spring-boot:run
```

æˆ–è€…:

```bash
# æ‰“åŒ…è¿è¡Œ
mvn clean package
java -jar target/langchain4j-order-0.0.1-SNAPSHOT.jar
```

### 4. æµ‹è¯•

é¡¹ç›®å¯åŠ¨åï¼Œè®¿é—®:

- **Webæµ‹è¯•ç•Œé¢**: http://localhost:8080/chat.html
- **å¥åº·æ£€æŸ¥**: http://localhost:8080/api/chat/health

## API æ¥å£

### åŸºç¡€æ¥å£

| æ–¹æ³• | è·¯å¾„ | æè¿° |
|------|------|------|
| POST | `/api/chat/message` | å‘é€æ¶ˆæ¯ï¼ˆè‡ªåŠ¨ç”Ÿæˆä¼šè¯IDï¼‰ |
| POST | `/api/chat/message/{sessionId}` | å‘é€æ¶ˆæ¯ï¼ˆæŒ‡å®šä¼šè¯IDï¼‰ |
| GET | `/api/chat/session/{sessionId}/status` | è·å–ä¼šè¯çŠ¶æ€ |
| DELETE | `/api/chat/session/{sessionId}` | æ¸…é™¤ä¼šè¯è®°å¿† |
| GET | `/api/chat/health` | å¥åº·æ£€æŸ¥ |

### è¯·æ±‚ç¤ºä¾‹

#### å‘é€æ¶ˆæ¯

```bash
curl -X POST http://localhost:8080/api/chat/message \
  -H "Content-Type: application/json" \
  -d '{"message": "æˆ‘æƒ³åˆ›å»ºä¸€ä¸ªæ–°è®¢å•"}'
```

#### å“åº”ç¤ºä¾‹

```json
{
  "success": true,
  "response": "å¥½çš„ï¼Œæˆ‘æ¥å¸®æ‚¨åˆ›å»ºè®¢å•ã€‚è¯·å‘Šè¯‰æˆ‘æ‚¨éœ€è¦è®¢è´­ä»€ä¹ˆå•†å“ï¼Ÿ",
  "sessionId": "session-1703123456789-abc123",
  "timestamp": 1703123456789
}
```

## æµ‹è¯•ç¤ºä¾‹

### åˆ›å»ºè®¢å•
```
ç”¨æˆ·: æˆ‘æƒ³åˆ›å»ºä¸€ä¸ªæ–°è®¢å•
Agent: å¥½çš„ï¼Œæˆ‘æ¥å¸®æ‚¨åˆ›å»ºè®¢å•ã€‚è¯·å‘Šè¯‰æˆ‘æ‚¨éœ€è¦è®¢è´­ä»€ä¹ˆå•†å“ï¼Ÿ

ç”¨æˆ·: æˆ‘è¦ä¹°2ä¸ªiPhone 15
Agent: å¥½çš„ï¼Œæˆ‘ä¸ºæ‚¨åˆ›å»ºä¸€ä¸ªiPhone 15çš„è®¢å•ï¼Œæ•°é‡ä¸º2ä¸ªã€‚è®¢å•åˆ›å»ºæˆåŠŸï¼
```

### æŸ¥è¯¢è®¢å•
```
ç”¨æˆ·: æŸ¥è¯¢æˆ‘çš„è®¢å•
Agent: æˆ‘æ¥å¸®æ‚¨æŸ¥è¯¢è®¢å•ä¿¡æ¯ã€‚è¯·é—®æ‚¨è¦æŸ¥è¯¢å“ªä¸ªè®¢å•ï¼Ÿå¯ä»¥æä¾›è®¢å•IDå—ï¼Ÿ

ç”¨æˆ·: æŸ¥è¯¢è®¢å•123
Agent: æ­£åœ¨æŸ¥è¯¢è®¢å•IDä¸º123çš„è¯¦ç»†ä¿¡æ¯...
```

### æ›´æ–°è®¢å•
```
ç”¨æˆ·: æˆ‘æƒ³ä¿®æ”¹è®¢å•ä¿¡æ¯
Agent: å¥½çš„ï¼Œæˆ‘æ¥å¸®æ‚¨æ›´æ–°è®¢å•ã€‚è¯·å‘Šè¯‰æˆ‘æ‚¨è¦ä¿®æ”¹å“ªä¸ªè®¢å•ï¼Œä»¥åŠè¦ä¿®æ”¹ä»€ä¹ˆå†…å®¹ï¼Ÿ
```

### å–æ¶ˆè®¢å•
```
ç”¨æˆ·: å–æ¶ˆè®¢å•
Agent: æˆ‘æ¥å¸®æ‚¨å–æ¶ˆè®¢å•ã€‚è¯·æä¾›è¦å–æ¶ˆçš„è®¢å•IDã€‚
```

## æ¶æ„è¯´æ˜

### Agentæ¶æ„

```
TriageAgent (è·¯ç”±Agent)
â”œâ”€â”€ CreateOrderAgent (åˆ›å»ºè®¢å•)
â”œâ”€â”€ QueryOrderAgent (æŸ¥è¯¢è®¢å•)
â”œâ”€â”€ UpdateOrderAgent (æ›´æ–°è®¢å•)
â””â”€â”€ CancelOrderAgent (å–æ¶ˆè®¢å•)
```

### æ ¸å¿ƒç»„ä»¶

- **ChatMemoryManager**: ç»Ÿä¸€çš„å¯¹è¯è®°å¿†ç®¡ç†
- **ChatMemoryConfig**: è®°å¿†é…ç½®ç®¡ç†
- **OrderService**: è®¢å•ä¸šåŠ¡é€»è¾‘
- **å„ç§Tool**: å…·ä½“çš„è®¢å•æ“ä½œå·¥å…·

### è®°å¿†ç®¡ç†

- **ä¼šè¯çº§è®°å¿†**: æ¯ä¸ªç”¨æˆ·ä¼šè¯ç‹¬ç«‹çš„å¯¹è¯å†å²
- **Agentçº§è®°å¿†**: æ¯ä¸ªAgentç‹¬ç«‹çš„å¯¹è¯å†å²
- **è·¨Agentä¸Šä¸‹æ–‡**: æ”¯æŒAgenté—´çš„ä¸Šä¸‹æ–‡ä¼ é€’
- **è‡ªåŠ¨æ¸…ç†**: å®šæ—¶æ¸…ç†è¿‡æœŸä¼šè¯

## é…ç½®è¯´æ˜

### Chat Memory é…ç½®

```yaml
chat:
  memory:
    default-max-messages: 20          # é»˜è®¤æœ€å¤§æ¶ˆæ¯æ•°
    session-max-messages: 50          # ä¼šè¯æœ€å¤§æ¶ˆæ¯æ•°
    agent-max-messages: 30            # Agentæœ€å¤§æ¶ˆæ¯æ•°
    enable-cross-agent-context: true  # å¯ç”¨è·¨Agentä¸Šä¸‹æ–‡
    session-timeout-minutes: 30       # ä¼šè¯è¶…æ—¶æ—¶é—´(åˆ†é’Ÿ)
    enable-session-persistence: false # å¯ç”¨ä¼šè¯æŒä¹…åŒ–
    memory-cleanup-interval-minutes: 60 # å†…å­˜æ¸…ç†é—´éš”(åˆ†é’Ÿ)
    max-active-sessions: 100          # æœ€å¤§æ´»è·ƒä¼šè¯æ•°
```

## å¼€å‘è¯´æ˜

### æ·»åŠ æ–°çš„Agent

1. åˆ›å»ºAgentç±»ï¼Œç»§æ‰¿åŸºç¡€æ¨¡å¼
2. å®ç°å¯¹åº”çš„Toolç±»
3. åœ¨TriageAgentä¸­æ·»åŠ è·¯ç”±é€»è¾‘
4. æ›´æ–°ChatMemoryManageræ”¯æŒæ–°Agent

### è‡ªå®šä¹‰é…ç½®

å¯ä»¥é€šè¿‡ä¿®æ”¹ `application.yml` æˆ–è®¾ç½®ç¯å¢ƒå˜é‡æ¥è‡ªå®šä¹‰é…ç½®ã€‚

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **ç¼–è¯‘é”™è¯¯**: ç¡®ä¿Javaç‰ˆæœ¬ä¸º17+
2. **å¯åŠ¨å¤±è´¥**: æ£€æŸ¥ç«¯å£8080æ˜¯å¦è¢«å ç”¨
3. **AIå“åº”å¼‚å¸¸**: æ£€æŸ¥OpenAI API Keyé…ç½®
4. **å†…å­˜ä¸è¶³**: è°ƒæ•´JVMå‚æ•°æˆ–å‡å°‘æœ€å¤§ä¼šè¯æ•°

### æ—¥å¿—æŸ¥çœ‹

é¡¹ç›®ä½¿ç”¨SLF4Jæ—¥å¿—æ¡†æ¶ï¼Œå¯ä»¥é€šè¿‡ä¿®æ”¹ `application.yml` ä¸­çš„æ—¥å¿—çº§åˆ«æ¥è°ƒæ•´æ—¥å¿—è¾“å‡ºã€‚

## è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ã€‚